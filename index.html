<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#f8f9fa">
    <title>Часы с именами</title>
    <style>
        /* CSS Reset и базовые стили */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Светлая тема */
            --bg-color: #f8f9fa;
            --text-color: #2c3e50;
            --border-color: #e9ecef;
            --hover-color: #e3f2fd;
            --active-color: #bbdefb;
            --button-bg: #ffffff;
            --button-border: #dee2e6;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            --shadow-hover: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        [data-theme="dark"] {
            /* Темная тема */
            --bg-color: #1a1a1a;
            --text-color: #e9ecef;
            --border-color: #495057;
            --hover-color: #2d3748;
            --active-color: #4a5568;
            --button-bg: #2d3748;
            --button-border: #4a5568;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            --shadow-hover: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem;
            transition: background-color 0.2s ease, color 0.2s ease;
        }

        .container {
            max-width: 600px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            padding: 0 1rem;
        }

        .title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-color);
        }

        .controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .theme-control {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
        }

        .theme-label {
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--text-color);
            opacity: 0.8;
            text-align: center;
        }

        .language-control {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
        }

        .language-toggle {
            background: var(--button-bg);
            border: 1px solid var(--button-border);
            color: var(--text-color);
            padding: 0.3rem 0.6rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            font-family: inherit;
            font-weight: 600;
            transition: all 0.2s ease;
            min-height: 32px;
            min-width: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .language-toggle:hover {
            background: var(--hover-color);
            box-shadow: var(--shadow-hover);
        }

        .language-toggle:focus {
            outline: 2px solid var(--active-color);
            outline-offset: 2px;
        }

        .btn {
            background: var(--button-bg);
            border: 1px solid var(--button-border);
            color: var(--text-color);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-family: inherit;
            transition: all 0.2s ease;
            min-height: 44px;
            min-width: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn:hover {
            background: var(--hover-color);
            box-shadow: var(--shadow-hover);
        }

        .btn:focus {
            outline: 2px solid var(--active-color);
            outline-offset: 2px;
        }

        .theme-toggle {
            position: relative;
            width: 50px;
            height: 24px;
            background: var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .theme-toggle::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.2s ease;
        }

        [data-theme="dark"] .theme-toggle {
            background: var(--active-color);
        }

        [data-theme="dark"] .theme-toggle::after {
            transform: translateX(26px);
        }

        .clock-container {
            position: relative;
            width: min(90vw, 400px);
            height: min(90vw, 400px);
            max-width: 400px;
            max-height: 400px;
        }

        .clock-svg {
            width: 100%;
            height: 100%;
            cursor: pointer;
            filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.1));
        }

        [data-theme="dark"] .clock-svg {
            filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.3));
        }

        .clock-face {
            fill: url(#clockGradient);
            stroke: var(--border-color);
            stroke-width: 3;
            filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.1));
        }

        [data-theme="dark"] .clock-face {
            filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.4));
        }

        .clock-inner {
            fill: var(--button-bg);
            stroke: var(--border-color);
            stroke-width: 2;
        }

        .hour-segment {
            fill: transparent;
            stroke: none;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0.7;
        }

        .hour-segment-hit {
            fill: transparent;
            stroke: none;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0;
        }

        .hour-segment-hit:hover {
            opacity: 0.1;
        }

        .hour-segment:hover {
            opacity: 0.8;
        }

        .hour-segment:focus {
            outline: none;
            opacity: 0.9;
        }

        .hour-segment.active {
            opacity: 1;
        }


        .hour-line {
            stroke: var(--text-color);
            stroke-width: 2;
            opacity: 0.3;
        }

        .hour-line-major {
            stroke: var(--text-color);
            stroke-width: 3;
            opacity: 0.6;
        }

        .hour-number {
            fill: var(--text-color);
            font-size: 14px;
            font-weight: 700;
            text-anchor: middle;
            dominant-baseline: middle;
            pointer-events: all;
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1));
            letter-spacing: 0.2px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .hour-number:hover {
            fill: var(--active-color);
            font-size: 15px;
            font-weight: 800;
            filter: drop-shadow(0 0 8px var(--active-color)) drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
        }

        .hour-number:focus {
            fill: var(--active-color);
            font-size: 15px;
            font-weight: 800;
            filter: drop-shadow(0 0 8px var(--active-color)) drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
            outline: none;
        }

        .hour-number.active {
            fill: var(--active-color);
            font-size: 16px;
            font-weight: 900;
            filter: drop-shadow(0 0 12px var(--active-color)) drop-shadow(0 3px 6px rgba(0, 0, 0, 0.3));
        }


        .hour-text {
            fill: var(--text-color);
            font-size: 12px;
            font-weight: 600;
            text-anchor: middle;
            dominant-baseline: middle;
            pointer-events: none;
            max-width: 60px;
            opacity: 0.95;
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.1));
            letter-spacing: 0.3px;
        }

        /* Стили для внешних меток с именами */
        .name-label {
            position: absolute;
            background: var(--button-bg);
            border: 2px solid var(--border-color);
            border-radius: 20px;
            padding: 0.4rem 0.8rem;
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-color);
            text-align: center;
            min-width: 60px;
            max-width: 120px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            z-index: 5;
            pointer-events: none;
            opacity: 0;
            transform: scale(0.8);
        }

        .name-label.show {
            opacity: 1;
            transform: scale(1);
        }

        .name-label:hover {
            box-shadow: var(--shadow-hover);
            transform: scale(1.05);
        }

        /* Стрелка от метки к циферблату */
        .name-label::before {
            content: '';
            position: absolute;
            width: 0;
            height: 0;
            border: 5px solid transparent;
        }

        /* Стрелки для разных позиций */
        .name-label[data-position="top"]::before {
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            border-top-color: var(--border-color);
        }

        .name-label[data-position="right"]::before {
            left: -10px;
            top: 50%;
            transform: translateY(-50%);
            border-right-color: var(--border-color);
        }

        .name-label[data-position="bottom"]::before {
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            border-bottom-color: var(--border-color);
        }

        .name-label[data-position="left"]::before {
            right: -10px;
            top: 50%;
            transform: translateY(-50%);
            border-left-color: var(--border-color);
        }

        /* Специальные позиции для углов */
        .name-label[data-position="top-right"]::before {
            bottom: -10px;
            left: 20%;
            transform: translateX(-50%);
            border-top-color: var(--border-color);
        }

        .name-label[data-position="top-left"]::before {
            bottom: -10px;
            right: 20%;
            transform: translateX(50%);
            border-top-color: var(--border-color);
        }

        .name-label[data-position="bottom-right"]::before {
            top: -10px;
            left: 20%;
            transform: translateX(-50%);
            border-bottom-color: var(--border-color);
        }

        .name-label[data-position="bottom-left"]::before {
            top: -10px;
            right: 20%;
            transform: translateX(50%);
            border-bottom-color: var(--border-color);
        }

        .center-dot {
            fill: url(#centerGradient);
            r: 5;
            filter: drop-shadow(0 2px 6px rgba(0, 0, 0, 0.3));
        }

        .center-ring {
            fill: none;
            stroke: var(--text-color);
            stroke-width: 3;
            opacity: 0.4;
            filter: drop-shadow(0 1px 3px rgba(0, 0, 0, 0.2));
        }

        .minute-marks {
            stroke: var(--text-color);
            stroke-width: 1;
            opacity: 0.15;
            filter: drop-shadow(0 1px 1px rgba(0, 0, 0, 0.1));
        }

        .minute-marks-major {
            stroke: var(--text-color);
            stroke-width: 2;
            opacity: 0.3;
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.15));
        }

        /* Дополнительные эффекты для реалистичности */
        .clock-svg:hover .hour-segment {
            opacity: 0.8;
        }

        .clock-svg:hover .hour-number {
            filter: drop-shadow(0 2px 6px rgba(0, 0, 0, 0.2));
        }

        /* Анимация появления элементов */
        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .hour-segment {
            animation: fadeInScale 0.5s ease-out;
        }

        .hour-number {
            animation: fadeInScale 0.6s ease-out;
        }

        .hour-text {
            animation: fadeInScale 0.7s ease-out;
        }

        .input-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 10;
        }

        .name-input {
            position: absolute;
            background: var(--button-bg);
            border: 2px solid var(--active-color);
            border-radius: 4px;
            padding: 0.25rem 0.5rem;
            font-size: 12px;
            font-family: inherit;
            color: var(--text-color);
            max-width: 80px;
            text-align: center;
            pointer-events: all;
            z-index: 20;
            box-shadow: var(--shadow);
        }

        .name-input:focus {
            outline: none;
            box-shadow: var(--shadow-hover);
        }

        .tooltip {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--button-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            box-shadow: var(--shadow-hover);
            z-index: 1000;
            text-align: center;
            max-width: 300px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .tooltip.show {
            opacity: 1;
        }

        .tooltip-text {
            font-size: 0.9rem;
            color: var(--text-color);
            margin-bottom: 0.5rem;
        }

        .tooltip-close {
            background: var(--active-color);
            border: none;
            color: var(--text-color);
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            pointer-events: all;
        }

        /* Адаптивность для мобильных устройств */
        @media (max-width: 480px) {
            .container {
                gap: 1rem;
            }

            .header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .title {
                font-size: 1.25rem;
            }

            .controls {
                justify-content: center;
            }

            .theme-label {
                font-size: 0.7rem;
            }

            .clock-container {
                width: min(85vw, 350px);
                height: min(85vw, 350px);
            }

            .hour-text {
                font-size: 10px;
                max-width: 50px;
            }

            .name-input {
                max-width: 70px;
                font-size: 11px;
            }

            .name-label {
                font-size: 0.75rem;
                padding: 0.3rem 0.6rem;
                min-width: 50px;
                max-width: 100px;
            }
        }

        /* Поддержка поворота экрана */
        @media (orientation: landscape) and (max-height: 500px) {
            .container {
                flex-direction: row;
                gap: 2rem;
                max-width: 100%;
            }

            .header {
                flex-direction: column;
                width: auto;
            }

            .clock-container {
                width: min(60vh, 300px);
                height: min(60vh, 300px);
            }
        }

        /* Улучшения для iOS Safari */
        @supports (-webkit-touch-callout: none) {
            .name-input {
                -webkit-appearance: none;
                appearance: none;
                border-radius: 4px;
            }

            .btn {
                -webkit-tap-highlight-color: transparent;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title" id="appTitle">English clock</h1>
            <div class="controls">
                <button class="btn" id="resetBtn" aria-label="Сбросить все имена">Сбросить</button>
                <div class="language-control">
                    <span class="theme-label" id="languageLabel">Язык</span>
                    <button class="language-toggle" id="languageToggle" aria-label="Переключить язык">RU</button>
                </div>
                <div class="theme-control">
                    <span class="theme-label" id="themeLabel">Тема</span>
                    <div class="theme-toggle" id="themeToggle" role="button" aria-label="Переключить тему" tabindex="0"></div>
                </div>
            </div>
        </div>

        <div class="clock-container">
            <svg class="clock-svg" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                <!-- Градиенты -->
                <defs>
                    <radialGradient id="clockGradient" cx="50%" cy="50%" r="50%">
                        <stop offset="0%" style="stop-color:var(--button-bg);stop-opacity:1" />
                        <stop offset="100%" style="stop-color:var(--border-color);stop-opacity:0.1" />
                    </radialGradient>
                    <radialGradient id="centerGradient" cx="50%" cy="50%" r="50%">
                        <stop offset="0%" style="stop-color:var(--text-color);stop-opacity:1" />
                        <stop offset="100%" style="stop-color:var(--text-color);stop-opacity:0.7" />
                    </radialGradient>
                </defs>
                
                <!-- Внешний круг циферблата -->
                <circle class="clock-face" cx="100" cy="100" r="95"/>
                
                <!-- Внутренний круг -->
                <circle class="clock-inner" cx="100" cy="100" r="55"/>
                
                <!-- Минутные метки -->
                <g id="minuteMarks">
                    <!-- Метки будут созданы динамически -->
                </g>
                
                <!-- Часовые сегменты и линии -->
                <g id="hourSegments">
                    <!-- Сегменты будут созданы динамически -->
                </g>
                
                <!-- Часовые числа -->
                <g id="hourNumbers">
                    <!-- Числа будут созданы динамически -->
                </g>
                
                <!-- Тексты имен -->
                <g id="hourTexts">
                    <!-- Тексты будут созданы динамически -->
                </g>
                
                <!-- Центральная точка с кольцом -->
                <circle class="center-ring" cx="100" cy="100" r="8"/>
                <circle class="center-dot" cx="100" cy="100" r="4"/>
            </svg>
            
            <!-- Оверлей для инпутов -->
            <div class="input-overlay" id="inputOverlay"></div>
        </div>
    </div>

    <!-- Подсказка -->
    <div class="tooltip" id="tooltip">
        <div class="tooltip-text" id="tooltipText">Нажмите на часовой сегмент, чтобы ввести имя</div>
        <button class="tooltip-close" id="tooltipClose">Понятно</button>
    </div>

    <script>
        /**
         * Часы с именами - Минималистичное SPA приложение
         * 
         * Функциональность:
         * - 12-часовой циферблат с возможностью назначения имен
         * - Сохранение данных в localStorage
         * - Поддержка светлой/темной темы
         * - Поддержка русского и английского языков
         * - Адаптивный дизайн для мобильных устройств
         * - Полная поддержка доступности
         * 
         * Запуск: просто откройте index.html в браузере
         */

        // Объект переводов
        const TRANSLATIONS = {
            ru: {
                title: 'Часы с именами',
                resetButton: 'Сбросить',
                resetButtonAria: 'Сбросить все имена',
                themeLabel: 'Тема',
                languageLabel: 'Язык',
                themeToggleAria: 'Переключить тему',
                languageToggleAria: 'Переключить язык',
                tooltipText: 'Нажмите на часовой сегмент, чтобы ввести имя',
                tooltipClose: 'Понятно',
                resetConfirm: 'Вы уверены, что хотите сбросить все имена?',
                hourAria: 'Час {hour}. {name}',
                noName: 'Без имени'
            },
            en: {
                title: 'Clock with Names',
                resetButton: 'Reset',
                resetButtonAria: 'Reset all names',
                themeLabel: 'Theme',
                languageLabel: 'Language',
                themeToggleAria: 'Toggle theme',
                languageToggleAria: 'Toggle language',
                tooltipText: 'Click on a hour segment to enter a name',
                tooltipClose: 'Got it',
                resetConfirm: 'Are you sure you want to reset all names?',
                hourAria: 'Hour {hour}. {name}',
                noName: 'No name'
            }
        };

        class ClockApp {
            constructor() {
                this.names = {};
                this.theme = 'light';
                this.language = 'ru'; // По умолчанию русский
                this.activeSegment = null;
                this.inputElement = null;
                this.tooltipShown = false;
                
                this.init();
            }

            init() {
                this.loadData();
                this.createClock();
                this.bindEvents();
                this.updateLanguage();
                this.showTooltipIfNeeded();
            }

            // Функция для получения перевода
            t(key, params = {}) {
                let text = TRANSLATIONS[this.language][key] || key;
                
                // Заменяем параметры в тексте
                Object.keys(params).forEach(param => {
                    text = text.replace(new RegExp(`\\{${param}\\}`, 'g'), params[param]);
                });
                
                return text;
            }

            // Загрузка данных из localStorage
            loadData() {
                const saved = localStorage.getItem('clockApp');
                if (saved) {
                    const data = JSON.parse(saved);
                    this.names = data.names || {};
                    this.theme = data.theme || 'light';
                    this.language = data.language || 'ru';
                }
                
                // Применяем тему
                document.documentElement.setAttribute('data-theme', this.theme);
                // Применяем язык
                document.documentElement.setAttribute('lang', this.language);
            }

            // Сохранение данных в localStorage
            saveData() {
                const data = {
                    names: this.names,
                    theme: this.theme,
                    language: this.language
                };
                localStorage.setItem('clockApp', JSON.stringify(data));
            }

            // Создание SVG циферблата
            createClock() {
                const minuteMarks = document.getElementById('minuteMarks');
                const hourSegments = document.getElementById('hourSegments');
                const hourNumbers = document.getElementById('hourNumbers');
                const hourTexts = document.getElementById('hourTexts');
                
                // Очищаем существующие элементы
                minuteMarks.innerHTML = '';
                hourSegments.innerHTML = '';
                hourNumbers.innerHTML = '';
                hourTexts.innerHTML = '';
                
                // Удаляем все внешние метки
                document.querySelectorAll('.name-label').forEach(label => label.remove());

                const centerX = 100;
                const centerY = 100;
                const radius = 85;
                const innerRadius = 60;

                // Создаем минутные метки
                for (let minute = 0; minute < 60; minute++) {
                    const angle = (minute - 15) * (Math.PI / 30); // Начинаем с 12 часов
                    const isMajor = minute % 5 === 0;
                    const markLength = isMajor ? 8 : 4;
                    const markRadius = radius + 5;
                    
                    const x1 = centerX + Math.cos(angle) * (markRadius - markLength);
                    const y1 = centerY + Math.sin(angle) * (markRadius - markLength);
                    const x2 = centerX + Math.cos(angle) * markRadius;
                    const y2 = centerY + Math.sin(angle) * markRadius;

                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('x1', x1);
                    line.setAttribute('y1', y1);
                    line.setAttribute('x2', x2);
                    line.setAttribute('y2', y2);
                    line.setAttribute('class', isMajor ? 'minute-marks-major' : 'minute-marks');
                    minuteMarks.appendChild(line);
                }

                // Создаем часовые элементы
                for (let hour = 1; hour <= 12; hour++) {
                    const angle = (hour - 3) * (Math.PI / 6); // Начинаем с 12 часов
                    const x1 = centerX + Math.cos(angle) * innerRadius;
                    const y1 = centerY + Math.sin(angle) * innerRadius;
                    const x2 = centerX + Math.cos(angle) * radius;
                    const y2 = centerY + Math.sin(angle) * radius;

                    // Создаем большую область наведения (невидимый круг)
                    const hitArea = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    const hitRadius = radius + 20; // Увеличиваем область наведения
                    const hitX = centerX + Math.cos(angle) * (radius - 10);
                    const hitY = centerY + Math.sin(angle) * (radius - 10);
                    
                    hitArea.setAttribute('cx', hitX);
                    hitArea.setAttribute('cy', hitY);
                    hitArea.setAttribute('r', hitRadius / 3);
                    hitArea.setAttribute('class', 'hour-segment-hit');
                    hitArea.setAttribute('data-hour', hour);
                    hitArea.setAttribute('tabindex', '0');
                    hitArea.setAttribute('role', 'button');
                    hitArea.setAttribute('aria-label', this.t('hourAria', { hour: hour, name: this.names[hour] || this.t('noName') }));
                    
                    hourSegments.appendChild(hitArea);

                    // Создаем визуальный сегмент (кликабельную область)
                    const segment = document.createElementNS('http://www.w3.org/2000/svg', 'path');
                    const startAngle = angle - Math.PI / 12;
                    const endAngle = angle + Math.PI / 12;
                    
                    const pathData = this.createSegmentPath(centerX, centerY, innerRadius, radius, startAngle, endAngle);
                    segment.setAttribute('d', pathData);
                    segment.setAttribute('class', 'hour-segment');
                    segment.setAttribute('data-hour', hour);
                    segment.setAttribute('tabindex', '0');
                    segment.setAttribute('role', 'button');
                    segment.setAttribute('aria-label', this.t('hourAria', { hour: hour, name: this.names[hour] || this.t('noName') }));
                    
                    hourSegments.appendChild(segment);

                    // Создаем часовую линию (только для основных часов)
                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('x1', x1);
                    line.setAttribute('y1', y1);
                    line.setAttribute('x2', x2);
                    line.setAttribute('y2', y2);
                    line.setAttribute('class', 'hour-line-major');
                    hourSegments.appendChild(line);

                    // Создаем часовое число
                    const numberX = centerX + Math.cos(angle) * (radius + 8);
                    const numberY = centerY + Math.sin(angle) * (radius + 8);
                    
                    const number = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    number.setAttribute('x', numberX);
                    number.setAttribute('y', numberY);
                    number.setAttribute('class', 'hour-number');
                    number.setAttribute('data-hour', hour);
                    number.setAttribute('tabindex', '0');
                    number.setAttribute('role', 'button');
                    number.setAttribute('aria-label', this.t('hourAria', { hour: hour, name: this.names[hour] || this.t('noName') }));
                    number.textContent = hour;
                    hourNumbers.appendChild(number);

                    // Создаем внешнюю метку с именем (если есть)
                    if (this.names[hour]) {
                        this.createNameLabel(hour, angle, centerX, centerY, radius);
                    }
                }
            }

            // Создание внешней метки с именем
            createNameLabel(hour, angle, centerX, centerY, radius) {
                const clockContainer = document.querySelector('.clock-container');
                
                // Позиционируем метку за пределами циферблата
                const labelDistance = radius + 35; // Оптимальное расстояние - не слишком близко, не слишком далеко
                const labelX = centerX + Math.cos(angle) * labelDistance;
                const labelY = centerY + Math.sin(angle) * labelDistance;
                
                // Определяем позицию стрелки метки
                let position = 'top';
                if (angle >= -Math.PI/6 && angle < Math.PI/6) position = 'right';
                else if (angle >= Math.PI/6 && angle < Math.PI/3) position = 'bottom-right';
                else if (angle >= Math.PI/3 && angle < 2*Math.PI/3) position = 'bottom';
                else if (angle >= 2*Math.PI/3 && angle < 5*Math.PI/6) position = 'bottom-left';
                else if (angle >= 5*Math.PI/6 || angle < -5*Math.PI/6) position = 'left';
                else if (angle >= -5*Math.PI/6 && angle < -2*Math.PI/3) position = 'top-left';
                else if (angle >= -2*Math.PI/3 && angle < -Math.PI/3) position = 'top';
                else if (angle >= -Math.PI/3 && angle < -Math.PI/6) position = 'top-right';
                
                const label = document.createElement('div');
                label.className = 'name-label show';
                label.setAttribute('data-hour', hour);
                label.setAttribute('data-position', position);
                label.textContent = this.names[hour];
                
                // Позиционируем метку относительно контейнера циферблата
                const clockRect = clockContainer.getBoundingClientRect();
                const scaleX = clockRect.width / 200; // 200 - это viewBox width
                const scaleY = clockRect.height / 200; // 200 - это viewBox height
                
                const actualX = labelX * scaleX;
                const actualY = labelY * scaleY;
                
                label.style.left = `${actualX - 30}px`;
                label.style.top = `${actualY - 15}px`;
                
                clockContainer.appendChild(label);
            }

            // Создание пути для сегмента
            createSegmentPath(centerX, centerY, innerRadius, outerRadius, startAngle, endAngle) {
                const x1 = centerX + Math.cos(startAngle) * innerRadius;
                const y1 = centerY + Math.sin(startAngle) * innerRadius;
                const x2 = centerX + Math.cos(endAngle) * innerRadius;
                const y2 = centerY + Math.sin(endAngle) * innerRadius;
                const x3 = centerX + Math.cos(endAngle) * outerRadius;
                const y3 = centerY + Math.sin(endAngle) * outerRadius;
                const x4 = centerX + Math.cos(startAngle) * outerRadius;
                const y4 = centerY + Math.sin(startAngle) * outerRadius;

                return `M ${x1} ${y1} L ${x2} ${y2} L ${x3} ${y3} L ${x4} ${y4} Z`;
            }

            // Привязка событий
            bindEvents() {
                // Клики по сегментам и цифрам
                document.addEventListener('click', (e) => {
                    if (e.target.classList.contains('hour-segment') || 
                        e.target.classList.contains('hour-segment-hit') ||
                        e.target.classList.contains('hour-number')) {
                        this.editSegment(e.target);
                    }
                });

                // Клавиатурные события
                document.addEventListener('keydown', (e) => {
                    if ((e.target.classList.contains('hour-segment') || 
                         e.target.classList.contains('hour-segment-hit') ||
                         e.target.classList.contains('hour-number')) && 
                        (e.key === 'Enter' || e.key === ' ')) {
                        e.preventDefault();
                        this.editSegment(e.target);
                    }
                });

                // Кнопка сброса
                document.getElementById('resetBtn').addEventListener('click', () => {
                    this.resetAll();
                });

                // Переключатель темы
                document.getElementById('themeToggle').addEventListener('click', () => {
                    this.toggleTheme();
                });

                // Переключатель языка
                document.getElementById('languageToggle').addEventListener('click', () => {
                    this.toggleLanguage();
                });

                // Закрытие подсказки
                document.getElementById('tooltipClose').addEventListener('click', () => {
                    this.hideTooltip();
                });

                // Закрытие подсказки по клику вне её
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.tooltip')) {
                        this.hideTooltip();
                    }
                });
            }

            // Редактирование сегмента
            editSegment(segment) {
                const hour = parseInt(segment.getAttribute('data-hour'));
                this.activeSegment = segment;
                
                // Убираем активный класс с других цифр
                document.querySelectorAll('.hour-number').forEach(s => s.classList.remove('active'));

                // Добавляем активный класс к соответствующей цифре
                const number = document.querySelector(`.hour-number[data-hour="${hour}"]`);
                if (number) {
                    number.classList.add('active');
                }

                // Создаем инпут
                this.createInput(hour);
            }

            // Создание инпута для редактирования
            createInput(hour) {
                // Удаляем существующий инпут
                if (this.inputElement) {
                    this.inputElement.remove();
                }

                const segment = document.querySelector(`[data-hour="${hour}"]`);
                const rect = segment.getBoundingClientRect();
                const clockRect = document.querySelector('.clock-container').getBoundingClientRect();
                
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'name-input';
                input.value = this.names[hour] || '';
                input.maxLength = 20;
                input.placeholder = 'Введите имя';
                
                // Позиционируем инпут
                const centerX = clockRect.left + clockRect.width / 2;
                const centerY = clockRect.top + clockRect.height / 2;
                const angle = (hour - 3) * (Math.PI / 6);
                const textX = centerX + Math.cos(angle) * 72.5;
                const textY = centerY + Math.sin(angle) * 72.5;
                
                input.style.left = `${textX - 40}px`;
                input.style.top = `${textY - 10}px`;
                
                document.getElementById('inputOverlay').appendChild(input);
                this.inputElement = input;
                
                // Фокусируем и выделяем текст
                input.focus();
                input.select();

                // Обработчики событий инпута
                input.addEventListener('blur', () => {
                    this.saveName(hour, input.value.trim());
                });

                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        this.saveName(hour, input.value.trim());
                    } else if (e.key === 'Escape') {
                        this.cancelEdit();
                    }
                });

                // Прокрутка к видимой области на мобильных устройствах
                if (window.innerWidth <= 768) {
                    setTimeout(() => {
                        input.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 100);
                }
            }

            // Сохранение имени
            saveName(hour, name) {
                if (name) {
                    this.names[hour] = name;
                } else {
                    delete this.names[hour];
                }
                
                this.updateDisplay(hour);
                this.saveData();
                this.cancelEdit();
            }

            // Отмена редактирования
            cancelEdit() {
                if (this.inputElement) {
                    this.inputElement.remove();
                    this.inputElement = null;
                }
                
                if (this.activeSegment) {
                    const hour = parseInt(this.activeSegment.getAttribute('data-hour'));
                    document.querySelectorAll('.hour-number').forEach(s => s.classList.remove('active'));
                    this.activeSegment = null;
                }
            }

            // Обновление отображения
            updateDisplay(hour) {
                // Удаляем существующую метку
                const existingLabel = document.querySelector(`.name-label[data-hour="${hour}"]`);
                if (existingLabel) {
                    existingLabel.remove();
                }
                
                // Создаем новую метку, если есть имя
                if (this.names[hour]) {
                    const angle = (hour - 3) * (Math.PI / 6);
                    const centerX = 100;
                    const centerY = 100;
                    const radius = 85;
                    this.createNameLabel(hour, angle, centerX, centerY, radius);
                }
                
                // Обновляем aria-label
                const segments = document.querySelectorAll(`[data-hour="${hour}"]`);
                const nameText = this.names[hour] || this.t('noName');
                const ariaText = this.t('hourAria', { hour: hour, name: nameText });
                
                segments.forEach(segment => {
                    segment.setAttribute('aria-label', ariaText);
                });
            }

            // Сброс всех имен
            resetAll() {
                if (confirm(this.t('resetConfirm'))) {
                    this.names = {};
                    this.saveData();
                    
                    // Удаляем все внешние метки
                    document.querySelectorAll('.name-label').forEach(label => label.remove());
                    
                    // Обновляем отображение
                    for (let hour = 1; hour <= 12; hour++) {
                        this.updateDisplay(hour);
                    }
                }
            }

            // Переключение темы
            toggleTheme() {
                this.theme = this.theme === 'light' ? 'dark' : 'light';
                document.documentElement.setAttribute('data-theme', this.theme);
                this.saveData();
            }

            // Переключение языка
            toggleLanguage() {
                this.language = this.language === 'ru' ? 'en' : 'ru';
                document.documentElement.setAttribute('lang', this.language);
                this.saveData();
                this.updateLanguage();
            }

            // Обновление всех текстов при смене языка
            updateLanguage() {
                // Обновляем заголовок страницы
                document.title = this.t('title');
                
                // Обновляем элементы интерфейса
                document.getElementById('appTitle').textContent = this.t('title');
                document.getElementById('resetBtn').textContent = this.t('resetButton');
                document.getElementById('resetBtn').setAttribute('aria-label', this.t('resetButtonAria'));
                document.getElementById('themeLabel').textContent = this.t('themeLabel');
                document.getElementById('languageLabel').textContent = this.t('languageLabel');
                document.getElementById('themeToggle').setAttribute('aria-label', this.t('themeToggleAria'));
                document.getElementById('languageToggle').setAttribute('aria-label', this.t('languageToggleAria'));
                document.getElementById('languageToggle').textContent = this.language.toUpperCase();
                document.getElementById('tooltipText').textContent = this.t('tooltipText');
                document.getElementById('tooltipClose').textContent = this.t('tooltipClose');
                
                // Обновляем aria-labels для всех часовых сегментов
                for (let hour = 1; hour <= 12; hour++) {
                    const segments = document.querySelectorAll(`[data-hour="${hour}"]`);
                    const nameText = this.names[hour] || this.t('noName');
                    const ariaText = this.t('hourAria', { hour: hour, name: nameText });
                    
                    segments.forEach(segment => {
                        segment.setAttribute('aria-label', ariaText);
                    });
                }
            }

            // Показ подсказки при первом запуске
            showTooltipIfNeeded() {
                const hasNames = Object.keys(this.names).length > 0;
                if (!hasNames && !this.tooltipShown) {
                    setTimeout(() => {
                        document.getElementById('tooltip').classList.add('show');
                        this.tooltipShown = true;
                    }, 1000);
                }
            }

            // Скрытие подсказки
            hideTooltip() {
                document.getElementById('tooltip').classList.remove('show');
            }
        }

        // Инициализация приложения при загрузке страницы
        document.addEventListener('DOMContentLoaded', () => {
            window.clockApp = new ClockApp();
        });

        // Обработка изменения ориентации экрана и размера окна
        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                // Пересоздаем циферблат для корректного отображения
                const app = window.clockApp;
                if (app) {
                    app.createClock();
                    // Пересоздаем все метки с именами
                    for (let hour = 1; hour <= 12; hour++) {
                        if (app.names[hour]) {
                            const angle = (hour - 3) * (Math.PI / 6);
                            app.createNameLabel(hour, angle, 100, 100, 85);
                        }
                    }
                }
            }, 100);
        });

        // Обработка изменения размера окна
        window.addEventListener('resize', () => {
            setTimeout(() => {
                const app = window.clockApp;
                if (app) {
                    // Пересоздаем все метки с именами при изменении размера
                    document.querySelectorAll('.name-label').forEach(label => label.remove());
                    for (let hour = 1; hour <= 12; hour++) {
                        if (app.names[hour]) {
                            const angle = (hour - 3) * (Math.PI / 6);
                            app.createNameLabel(hour, angle, 100, 100, 85);
                        }
                    }
                }
            }, 100);
        });
    </script>
</body>
</html>
